<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/primevue/resources/themes/md-light-indigo/theme.css" />
    <title>Headless Sample App</title>
</head>

<body class="text-neutral-100 bg-neutral-800">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <h1 class="text-center text-xl p-8 font-bold">Projects Published</h1>
    <div class="relative overflow-x-auto p-10" id="app">
        <div v-if="loadingState"
            class="fixed z-10 w-screen h-screen bg-neutral-950 inset-0 flex justify-center items-center flex-col gap-y-4">
            <div><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
                    <rect width="7.33" height="7.33" x="1" y="1" fill="currentColor">
                        <animate id="svgSpinnersBlocksWave0" attributeName="x" begin="0;svgSpinnersBlocksWave1.end+0.2s"
                            dur="0.6s" values="1;4;1" />
                        <animate attributeName="y" begin="0;svgSpinnersBlocksWave1.end+0.2s" dur="0.6s"
                            values="1;4;1" />
                        <animate attributeName="width" begin="0;svgSpinnersBlocksWave1.end+0.2s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                        <animate attributeName="height" begin="0;svgSpinnersBlocksWave1.end+0.2s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                    </rect>
                    <rect width="7.33" height="7.33" x="8.33" y="1" fill="currentColor">
                        <animate attributeName="x" begin="svgSpinnersBlocksWave0.begin+0.1s" dur="0.6s"
                            values="8.33;11.33;8.33" />
                        <animate attributeName="y" begin="svgSpinnersBlocksWave0.begin+0.1s" dur="0.6s"
                            values="1;4;1" />
                        <animate attributeName="width" begin="svgSpinnersBlocksWave0.begin+0.1s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                        <animate attributeName="height" begin="svgSpinnersBlocksWave0.begin+0.1s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                    </rect>
                    <rect width="7.33" height="7.33" x="1" y="8.33" fill="currentColor">
                        <animate attributeName="x" begin="svgSpinnersBlocksWave0.begin+0.1s" dur="0.6s"
                            values="1;4;1" />
                        <animate attributeName="y" begin="svgSpinnersBlocksWave0.begin+0.1s" dur="0.6s"
                            values="8.33;11.33;8.33" />
                        <animate attributeName="width" begin="svgSpinnersBlocksWave0.begin+0.1s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                        <animate attributeName="height" begin="svgSpinnersBlocksWave0.begin+0.1s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                    </rect>
                    <rect width="7.33" height="7.33" x="15.66" y="1" fill="currentColor">
                        <animate attributeName="x" begin="svgSpinnersBlocksWave0.begin+0.2s" dur="0.6s"
                            values="15.66;18.66;15.66" />
                        <animate attributeName="y" begin="svgSpinnersBlocksWave0.begin+0.2s" dur="0.6s"
                            values="1;4;1" />
                        <animate attributeName="width" begin="svgSpinnersBlocksWave0.begin+0.2s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                        <animate attributeName="height" begin="svgSpinnersBlocksWave0.begin+0.2s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                    </rect>
                    <rect width="7.33" height="7.33" x="8.33" y="8.33" fill="currentColor">
                        <animate attributeName="x" begin="svgSpinnersBlocksWave0.begin+0.2s" dur="0.6s"
                            values="8.33;11.33;8.33" />
                        <animate attributeName="y" begin="svgSpinnersBlocksWave0.begin+0.2s" dur="0.6s"
                            values="8.33;11.33;8.33" />
                        <animate attributeName="width" begin="svgSpinnersBlocksWave0.begin+0.2s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                        <animate attributeName="height" begin="svgSpinnersBlocksWave0.begin+0.2s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                    </rect>
                    <rect width="7.33" height="7.33" x="1" y="15.66" fill="currentColor">
                        <animate attributeName="x" begin="svgSpinnersBlocksWave0.begin+0.2s" dur="0.6s"
                            values="1;4;1" />
                        <animate attributeName="y" begin="svgSpinnersBlocksWave0.begin+0.2s" dur="0.6s"
                            values="15.66;18.66;15.66" />
                        <animate attributeName="width" begin="svgSpinnersBlocksWave0.begin+0.2s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                        <animate attributeName="height" begin="svgSpinnersBlocksWave0.begin+0.2s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                    </rect>
                    <rect width="7.33" height="7.33" x="15.66" y="8.33" fill="currentColor">
                        <animate attributeName="x" begin="svgSpinnersBlocksWave0.begin+0.3s" dur="0.6s"
                            values="15.66;18.66;15.66" />
                        <animate attributeName="y" begin="svgSpinnersBlocksWave0.begin+0.3s" dur="0.6s"
                            values="8.33;11.33;8.33" />
                        <animate attributeName="width" begin="svgSpinnersBlocksWave0.begin+0.3s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                        <animate attributeName="height" begin="svgSpinnersBlocksWave0.begin+0.3s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                    </rect>
                    <rect width="7.33" height="7.33" x="8.33" y="15.66" fill="currentColor">
                        <animate attributeName="x" begin="svgSpinnersBlocksWave0.begin+0.3s" dur="0.6s"
                            values="8.33;11.33;8.33" />
                        <animate attributeName="y" begin="svgSpinnersBlocksWave0.begin+0.3s" dur="0.6s"
                            values="15.66;18.66;15.66" />
                        <animate attributeName="width" begin="svgSpinnersBlocksWave0.begin+0.3s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                        <animate attributeName="height" begin="svgSpinnersBlocksWave0.begin+0.3s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                    </rect>
                    <rect width="7.33" height="7.33" x="15.66" y="15.66" fill="currentColor">
                        <animate id="svgSpinnersBlocksWave1" attributeName="x" begin="svgSpinnersBlocksWave0.begin+0.4s"
                            dur="0.6s" values="15.66;18.66;15.66" />
                        <animate attributeName="y" begin="svgSpinnersBlocksWave0.begin+0.4s" dur="0.6s"
                            values="15.66;18.66;15.66" />
                        <animate attributeName="width" begin="svgSpinnersBlocksWave0.begin+0.4s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                        <animate attributeName="height" begin="svgSpinnersBlocksWave0.begin+0.4s" dur="0.6s"
                            values="7.33;1.33;7.33" />
                    </rect>
                </svg></div>
            <div>Fetching Your Data</div>
        </div>
        <table v-else-if="!loadingState"
            class="w-full text-sm text-left rtl:text-right  dark:text-gray-400 ">
            <thead
                class="text-base uppercase border-solid border-2">
                <tr class="text-center">
                    <th scope="col" class="p-4 border-solid border-2">Project Key</th>
                    <th scope="col" class="p-4 border-solid border-2">Project Name</th>
                    <th scope="col" class="p-4 border-solid border-2">Project Poster</th>
                    <th scope="col" class="p-4 border-solid border-2"> Release Year</th>
                    <th scope="col" class="p-4">Videos Published</th>

                </tr>
            </thead>
            <tbody v-for="items of projectData" :key="items.key" class="border-solid border-2 text-center">
                <tr class="border-solid border-2">
                    <td class="border-solid border-2 ">{{items.key}}</td>
                    <td class="border-solid border-2 ">{{items.name}}</td>
                    <td class="max-h-[200px]">
                        <img class="max-h-[200px] mx-auto" :src="items.poster" alt="poster Image">
                    </td>
                    <td class="border-solid border-2 ">{{items.release_year}}</td>
                    <td class="p-4" style="text-align: -webkit-center;">
                        <template v-for="videoItem of items.videos" :key="videoItem.key">
                <tr>
                    <td class="p-4">{{videoItem.name}}</td>
                    <td class="max-h-[100px] p-4">
                        <img class="max-h-[100px] mx-auto" :src="videoItem.poster" alt="Thumbnail Image">
                    </td>
                </tr>
                </template>
                </td>

                </tr>
            </tbody>
        </table>
    </div>
    <script>
        const { createApp, ref, onMounted } = Vue;
        const apiUrl = 'https://api.indee.tv/cms/v1'
        createApp({
            setup() {
                const incomingProjectData = ref([])
                const projectData = ref([])
                const authToken = ref('')
                const loadingState = ref(true)

                onMounted(async () => {
                    const authResponseData = await fetch(apiUrl + '/auth/validate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer <API_KEY_PLACEHOLDER>`,
                        },
                        body: JSON.stringify({
                            'type': 'pin',
                            'credentials':
                            {
                                'pin': '<ACCESS_PIN_PLACEHOLDER>'
                            }
                        })
                    })
                    const authRes = await authResponseData.json()
                    authToken.value = authRes.token
                    const projectDetailsResponse = await fetch(apiUrl + '/meta/get-authorized-content', {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `JWT ${authToken.value}`,
                        },
                    })
                    const projectRes = await projectDetailsResponse.json()
                    incomingProjectData.value = projectRes
                    projectData.value = incomingProjectData.value.map(data => {
                        return {
                            name: data.name,
                            release_year: data.release_year,
                            poster: data.poster,
                            key: data.key,
                            videos: data.videos || []
                        }
                    })
                    loadingState.value = false
                })
                return { projectData,loadingState }
            }
        }).mount('#app');
    </script>
</body>

</html>